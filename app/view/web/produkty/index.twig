{% extends "web/base.twig" %}

{% block title %} VegaPo - {{ lang.PRODUCTS }} {% endblock %}

{% block content %}
<section id="main">
	<div class="container">
		<div class="wow fadeInUp text-center">
            <h2>{{ params.oblubene ? lang.FAVOURITES }}
                {{ lang.PRODUCTS }}
                {{ username ? "| " ~ username }}
                {# search phrase #}
                {% if params['hladat']|length %}
                  | <a href="{{ stripUrlParam(params, 'hladat') }}">"{{ params['hladat'] }}"</a>
                {% endif %}
                {# category #}
                {% if current_category|length %}
                  | <a href="{{ stripUrlParam(params, 'kategoria') }}">{{ current_category.name }}</a>
                {% endif %}
                {# supermarket #}
                {% if current_supermarket|length %}
                  | <a href="{{ stripUrlParam(params, 'supermarket') }}">{{ current_supermarket.name }}</a>
                {% endif %}
                {# tags #}
                {% for current_tag in current_tags %}
                  | <a href="{{ stripUrlParam(params, 'tag', current_tag.slug) }}">{{ current_tag.name }}</a>
                {% endfor %}
            </h2>
        </div>


            <div class="card productFilterBox" >
                <div class="card-body">
                    <div class="row">
                    <!-- DROPDOWN SUPERMARKETS -->
                    <span class="dropdown col-md-auto">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">
                            {{ lang.SUPERMARKETS }}
                           </button>
                        <div class="dropdown-menu">
                            {% for supermarket in supermarkets %}
                              {# only show not used supermarket #}
                              {% if supermarket.slug not in params['supermarket'] %}
                                 <a class="dropdown-item hideOnClick"
                                 href="{{ buildUrl(params, 'supermarket', supermarket.slug)}}">
                                   {{ supermarket.name }}
                                 </a>
                              {% endif %}
                            {% endfor %}
                        </div>
                    </span>
                    <!-- DROPDOWN CATEGORIES -->
                    <span class="dropdown col-md-auto">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">
                            {{ lang.CATEGORIES }}
                        </button>
                        <div class="dropdown-menu">
                            {% for category in categories %}
                              {# only show not used category #}
                              {% if category.slug not in params['kategoria'] %}
                                <a class="dropdown-item hideOnClick"
                                href="{{ buildUrl(params, 'kategoria', category.slug) }}">
                                    {{ category.name }}
                                </a>
                              {% endif %}
                            {% endfor %}
                        </div>
                    </span>
                    <!-- DROPDOWN TAGS -->
                    <span class="dropdown col-md-auto">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-toggle="dropdown">
                            {{ lang.TAGS }}
                        </button>
                        <div class="dropdown-menu">
                            {% for tag in tags %}
                              {# only show not yet used tags #}
                              {% if tag.slug not in params['tag'] %}
                                <a class="dropdown-item hideOnClick"
                                href="{{ buildUrl(params, 'tag', tag.slug) }}">
                                    {{ tag.name }}
                                </a>
                              {% endif %}
                            {% endfor %}
                        </div>
                    </span>

                    <!-- DROPDOWN SORT -->
                    <span class="dropdown col-md-auto">
                      <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        {{ lang.PRODUCTS_SORT }}
                        {% if sorting %}
                          {% if sorting == 'name' %}
                            {{ lang.SORT ~ lang.PRODUCTS_SORT_NAME}}
                          {% elseif sorting == 'pricea' %}
                            {{ lang.SORT ~ lang.PRODUCTS_SORT_PRICEA}}
                          {% elseif sorting == 'priced' %}
                            {{ lang.SORT ~ lang.PRODUCTS_SORT_PRICED}}
                          {% elseif sorting == 'datea' %}
                            {{ lang.SORT ~ lang.PRODUCTS_SORT_DATEA}}
                          {% elseif sorting == 'dated' %}
                            {{ lang.SORT ~ lang.PRODUCTS_SORT_DATED}}
                          {% endif %}
                        {% endif %}
                      </button>
                      <div class="dropdown-menu" aria-labelledby="dropdownMenuButton">
                        <a class="dropdown-item" href="{{ buildUrl(params, 'sort', 'name') }}">{{ lang.PRODUCTS_SORT_NAME}}</a>
                        <a class="dropdown-item" href="{{ buildUrl(params, 'sort', 'pricea') }}">{{ lang.PRODUCTS_SORT_PRICEA}}</a>
                        <a class="dropdown-item" href="{{ buildUrl(params, 'sort', 'priced') }}">{{ lang.PRODUCTS_SORT_PRICED}}</a>
                        <a class="dropdown-item" href="{{ buildUrl(params, 'sort', 'datea') }}">{{ lang.PRODUCTS_SORT_DATEA}}</a>
                        <a class="dropdown-item" href="{{ buildUrl(params, 'sort', 'dated') }}">{{ lang.PRODUCTS_SORT_DATED}}</a>
                      </div>
                    </span>

                    <!-- SEARCH FORM -->
                    <form class="form-inline" method="get" action="/produkty">
                        <div class="input-group">
                          <input class="form-control"  name="hladat" placeholder="...">
                          <span class="input-group-btn">
                            <button class="btn btn-secondary" type="button">
                                <i class="ion-search"></i>
                            </button>
                          </span>
                        </div>

                    </form>

                </div>
            </div>
        </div>
      
            <div class="flex-row row">

                {% for product in products %}
                <div class="col-xs-6 col-sm-4 col-lg-3">
                    <a href="/produkty/produkt/{{ product.slug }}">
                    <img class="b-lazy card-img-top img-fluid" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" data-src="{{ "/uploads/products/#{ cc }/450x450/#{product.image}" }}">

                    <div class="card-block">
                        <p class="card-title">{{ product.name }}</p>
                    </div>
                    </a>
                </div>
            {% endfor %}
            </div>

        <br>
        <div class="row">
                <ul class="pagination justify-content-center" style="width: 100%">
                    {# classic pagination if nop < 10 #}
                    {% if number_of_pages and number_of_pages < 10 %}
                        {% for i in 1..number_of_pages %}
                            <li class="page-item {{ i == current_page ? 'active' }}">
                                <a class="page-link" href="{{ buildUrl(params, 'p', i) }}">
                                        {{ i }}
                                </a>
                            </li>
                        {% endfor %}
                    {# special pagination for nop > 10 #}
                    {% elseif number_of_pages and number_of_pages >= 10  %}
                        {# if current page < 5 show all preceding pages #}
                        {% if current_page < 5 and current_page > 1 %}
                            {% for i in 1..(current_page - 1) %}
                                <li class="page-item">
                                    <a href="{{ buildUrl(params, 'p', i) }}" class="page-link">
                                        {{ i }}
                                    </a>
                                </li>
                            {% endfor %}
                        {% endif %}
                        {# if current page > 5 show only 3 pages back and 1 #}
                        {% if current_page >= 5 %}
                            <li class="page-item">
                                <a href="{{ buildUrl(params, 'p', 1) }}" class="page-link">1 </a>
                            </li>
                            {% for i in (current_page - 3)..(current_page - 1) %}
                                <li class="page-item">
                                    <a href="{{ buildUrl(params, 'p', i) }}" class="page-link">
                                        {{ i }}
                                    </a>
                                </li>
                            {% endfor %}
                        {% endif %}
                        {# always show current page #}
                        <li class="page-item active">
                            <a href="{{ buildUrl(params, 'p', current_page) }}" class="page-link">
                                {{ current_page }}
                            </a>
                        </li>
                        {# show all the next pages#}
                        {% if (number_of_pages - current_page) < 5 and current_page < number_of_pages %}
                            {% for i in (current_page + 1)..(number_of_pages)  if number_of_pages > current_page %}
                                <li class="page-item">
                                    <a href="{{ buildUrl(params, 'p', i) }}" class="page-link">
                                        {{ i }}
                                    </a>
                                </li>
                            {% endfor %}
                        {# show only 3 next pages and last page  #}
                        {% elseif current_page != number_of_pages %}
                            {% for i in (current_page + 1)..(current_page + 3) %}
                                <li class="page-item">
                                    <a href="{{ buildUrl(params, 'p', i) }}" class="page-link">
                                        {{ i }}
                                    </a>
                                </li>
                            {% endfor %}
                            <li class="page-item">
                                <a href="{{ buildUrl(params, 'p', number_of_pages) }}" class="page-link">
                                   {{ number_of_pages }}
                                </a>
                            </li>
                        {% endif %}

                    {% endif %}

                </ul>
        </div>

	</div>
</section>


{% endblock %}
